package Project.View;

import Project.Controller.ScoreDAO;
import Project.Model.Score;
import Project.Model.Subjects;
import Project.Controller.SubjectsDAO;
import Project.Model.Classroom;
import Project.Controller.ClassroomDAO;
import Project.Model.Student;
import Project.Controller.StudentDAO;
import java.awt.event.KeyEvent;
import java.util.List;
import javax.swing.JOptionPane;

public class FrmUpdateScore extends javax.swing.JFrame {

  /**
   * Creates new form FrmUpdateScore
   */
  ScoreDAO sd = new ScoreDAO();
  private String idStudent = "";
  private String idSub = "";

  FrmListScore frmd = new FrmListScore();

  public String getIdStudent() {
    return idStudent;
  }

  public void setIdStudent(String idStudent) {
    this.idStudent = idStudent;
  }

  public String getIdSub() {
    return idSub;
  }

  public void setIdSub(String idSub) {
    this.idSub = idSub;
  }

  public FrmUpdateScore() {
    initComponents();
    setLocationRelativeTo(null);
    setResizable(false);
  }

  /**
   * This method is called from within the constructor to initialize the form.
   * WARNING: Do NOT modify this code. The content of this method is always
   * regenerated by the Form Editor.
   */
  @SuppressWarnings("unchecked")
  // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
  private void initComponents() {

    jLabel1 = new javax.swing.JLabel();
    cboMaSV = new javax.swing.JComboBox<>();
    jLabel2 = new javax.swing.JLabel();
    cboMaMH = new javax.swing.JComboBox<>();
    jLabel4 = new javax.swing.JLabel();
    txtTern = new javax.swing.JTextField();
    btnCapNhat = new javax.swing.JButton();
    btnDong = new javax.swing.JButton();
    jLabel5 = new javax.swing.JLabel();
    cboMaPhong = new javax.swing.JComboBox<>();
    jLabel6 = new javax.swing.JLabel();
    txtScore = new javax.swing.JTextField();

    setDefaultCloseOperation(javax.swing.WindowConstants.DISPOSE_ON_CLOSE);
    setResizable(false);
    addWindowListener(new java.awt.event.WindowAdapter() {
      public void windowOpened(java.awt.event.WindowEvent evt) {
        formWindowOpened(evt);
      }
    });

    jLabel1.setText("ID Student:");

    cboMaSV.setModel(new javax.swing.DefaultComboBoxModel<>(new String[] { "Item 1", "Item 2", "Item 3", "Item 4" }));

    jLabel2.setText("ID Subject: ");

    cboMaMH.setModel(new javax.swing.DefaultComboBoxModel<>(new String[] { "Item 1", "Item 2", "Item 3", "Item 4" }));

    jLabel4.setText("Score:");

    txtTern.addKeyListener(new java.awt.event.KeyAdapter() {
      public void keyReleased(java.awt.event.KeyEvent evt) {
        txtTernKeyReleased(evt);
      }
    });

    btnCapNhat.setIcon(new javax.swing.ImageIcon(getClass().getResource("/Project/images/book_edit.png"))); // NOI18N
    btnCapNhat.setText("Update");
    btnCapNhat.addActionListener(new java.awt.event.ActionListener() {
      public void actionPerformed(java.awt.event.ActionEvent evt) {
        btnCapNhatActionPerformed(evt);
      }
    });

    btnDong.setIcon(new javax.swing.ImageIcon(getClass().getResource("/Project/images/cancel.gif"))); // NOI18N
    btnDong.setText("Cancle");
    btnDong.addActionListener(new java.awt.event.ActionListener() {
      public void actionPerformed(java.awt.event.ActionEvent evt) {
        btnDongActionPerformed(evt);
      }
    });

    jLabel5.setText("ID Classroom:");

    cboMaPhong.setModel(new javax.swing.DefaultComboBoxModel<>(new String[] { "Item 1", "Item 2", "Item 3", "Item 4" }));

    jLabel6.setText("Term: ");

    txtScore.addKeyListener(new java.awt.event.KeyAdapter() {
      public void keyReleased(java.awt.event.KeyEvent evt) {
        txtScoreKeyReleased(evt);
      }
    });

    javax.swing.GroupLayout layout = new javax.swing.GroupLayout(getContentPane());
    getContentPane().setLayout(layout);
    layout.setHorizontalGroup(
      layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
      .addGroup(layout.createSequentialGroup()
        .addContainerGap()
        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING, false)
          .addComponent(jLabel6, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
          .addComponent(jLabel5, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
          .addComponent(jLabel4, javax.swing.GroupLayout.Alignment.LEADING, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
          .addComponent(jLabel1, javax.swing.GroupLayout.Alignment.LEADING, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
          .addComponent(jLabel2, javax.swing.GroupLayout.Alignment.LEADING, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
          .addGroup(layout.createSequentialGroup()
            .addGap(0, 28, Short.MAX_VALUE)
            .addComponent(btnCapNhat)
            .addGap(18, 18, 18)
            .addComponent(btnDong))
          .addComponent(txtTern)
          .addComponent(cboMaMH, 0, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
          .addComponent(cboMaSV, 0, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
          .addComponent(cboMaPhong, 0, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
          .addComponent(txtScore, javax.swing.GroupLayout.Alignment.TRAILING))
        .addContainerGap())
    );
    layout.setVerticalGroup(
      layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
      .addGroup(layout.createSequentialGroup()
        .addContainerGap()
        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
          .addComponent(jLabel1)
          .addComponent(cboMaSV, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
        .addGap(23, 23, 23)
        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
          .addComponent(jLabel2)
          .addComponent(cboMaMH, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
        .addGap(23, 23, 23)
        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
          .addComponent(jLabel5)
          .addComponent(cboMaPhong, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
        .addGap(23, 23, 23)
        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
          .addComponent(jLabel6)
          .addComponent(txtTern, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
        .addGap(23, 23, 23)
        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
          .addComponent(jLabel4)
          .addComponent(txtScore, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
        .addGap(18, 18, 18)
        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
          .addComponent(btnCapNhat)
          .addComponent(btnDong))
        .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
    );

    pack();
  }// </editor-fold>//GEN-END:initComponents

  public void Jop(String a) {
    JOptionPane.showMessageDialog(rootPane, a);
  }
    private void btnDongActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnDongActionPerformed
      this.dispose();
    }//GEN-LAST:event_btnDongActionPerformed

    private void btnCapNhatActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnCapNhatActionPerformed
      Update();
    }//GEN-LAST:event_btnCapNhatActionPerformed

    private void formWindowOpened(java.awt.event.WindowEvent evt) {//GEN-FIRST:event_formWindowOpened
      displayIPClassroom();
      displayIDSubject();
      displayStudent();
      if (!idStudent.isEmpty()) {
        this.setTitle("Update Score");
        btnCapNhat.setText("Update");
        displayDetails();
      } else {
        this.setTitle("Add Score");
        btnCapNhat.setText("Add");
      }
    }//GEN-LAST:event_formWindowOpened

  private void txtTernKeyReleased(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_txtTernKeyReleased
    if (evt.getKeyCode() == KeyEvent.VK_ENTER) {
      txtScore.requestFocus();
    }
  }//GEN-LAST:event_txtTernKeyReleased

  private void txtScoreKeyReleased(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_txtScoreKeyReleased
    if (evt.getKeyCode() == KeyEvent.VK_ENTER) {
      Update();
    }
  }//GEN-LAST:event_txtScoreKeyReleased

  private void Update() {
    Score sc = new Score();
    String strTerm = txtTern.getText();
    String strScore = txtScore.getText();

    if (strTerm.isEmpty()) {
      Jop("Tern Null");
      return;
    }
    float score = 0;
    try {
      score = Float.parseFloat(strScore);
      if (score > 10 || score < 0) {
        Jop("Error Number");
        return;
      }
    } catch (NumberFormatException e) {
      Jop("Error Number");
      return;
    }
    sc.setScoree(score);
    sc.setTern(strTerm);
    
    String strIdStudent = (String) cboMaSV.getSelectedItem();
    Student st = new Student();
    st.setIdStudent(strIdStudent);
    sc.setStudent(st);

    String strIdSubject = (String) cboMaMH.getSelectedItem();
    Subjects sb = new Subjects();
    sb.setIdSubject(strIdSubject);
    sc.setSubjects(sb);

    String strClassroom = (String) cboMaPhong.getSelectedItem();
    Classroom cr = new Classroom();
    cr.setName(strClassroom);
    sc.setClassroom(cr);
    
    boolean kq = false;
    if (idStudent == null || idStudent.isEmpty()) {
      if (ScoreDAO.getInstance().CheckID(sc.getStudent().getIdStudent(), sc.getSubjects().getIdSubject())) {
        kq = sd.newAdd(sc);
      } else {
        Jop("ID existed");
        return;
      }
    } else {
      kq = sd.edit(sc);
    }
    if (kq) {
      JOptionPane.showMessageDialog(rootPane, "Sucess");
      frmd.displayScore();
      frmd.setVisible(true);
    }
    this.dispose();
  }

  private void displayStudent() {
    List<Student> lst = new StudentDAO().getAllMaSV();
    cboMaSV.removeAllItems();
    lst.forEach((sv) -> {
      cboMaSV.addItem(sv.getIdStudent());
    });
  }

  private void displayIDSubject() {
    cboMaMH.removeAllItems();
    List<Subjects> lst = new SubjectsDAO().getAllMaMH();
    lst.forEach((mh) -> {
      cboMaMH.addItem(mh.getIdSubject());
    });
  }

  private void displayIPClassroom() {
    cboMaPhong.removeAllItems();
    List<Classroom> lst = new ClassroomDAO().getAllMaP();
    lst.forEach((sv) -> {
      cboMaPhong.addItem(sv.getName());
    });
  }

  private void displayDetails() {
    Score sb1 = sd.getByID(idStudent, idSub);
    if (sb1 != null) {
      cboMaSV.setSelectedItem(idStudent);
      cboMaMH.setSelectedItem(idSub);
      cboMaPhong.setSelectedItem(sb1.getNameClassroom());
      txtScore.setText(sb1.getScoree() + "");
      txtTern.setText(sb1.getTern());
    } else {
      System.out.println("sb null");
    }
  }

  /**
   * @param args the command line arguments
   */
  public static void main(String args[]) {
    /* Set the Nimbus look and feel */
    //<editor-fold defaultstate="collapsed" desc=" Look and feel setting code (optional) ">
    /* If Nimbus (introduced in Java SE 6) is not available, stay with the default look and feel.
         * For details see http://download.oracle.com/javase/tutorial/uiswing/lookandfeel/plaf.html 
     */
    try {
      for (javax.swing.UIManager.LookAndFeelInfo info : javax.swing.UIManager.getInstalledLookAndFeels()) {
        if ("Nimbus".equals(info.getName())) {
          javax.swing.UIManager.setLookAndFeel(info.getClassName());
          break;
        }
      }
    } catch (ClassNotFoundException ex) {
      java.util.logging.Logger.getLogger(FrmUpdateScore.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
    } catch (InstantiationException ex) {
      java.util.logging.Logger.getLogger(FrmUpdateScore.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
    } catch (IllegalAccessException ex) {
      java.util.logging.Logger.getLogger(FrmUpdateScore.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
    } catch (javax.swing.UnsupportedLookAndFeelException ex) {
      java.util.logging.Logger.getLogger(FrmUpdateScore.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
    }
    //</editor-fold>
    //</editor-fold>
    //</editor-fold>
    //</editor-fold>

    /* Create and display the form */
    java.awt.EventQueue.invokeLater(new Runnable() {
      public void run() {
        new FrmUpdateScore().setVisible(true);
      }
    });
  }

  // Variables declaration - do not modify//GEN-BEGIN:variables
  private javax.swing.JButton btnCapNhat;
  private javax.swing.JButton btnDong;
  private javax.swing.JComboBox<String> cboMaMH;
  private javax.swing.JComboBox<String> cboMaPhong;
  private javax.swing.JComboBox<String> cboMaSV;
  private javax.swing.JLabel jLabel1;
  private javax.swing.JLabel jLabel2;
  private javax.swing.JLabel jLabel4;
  private javax.swing.JLabel jLabel5;
  private javax.swing.JLabel jLabel6;
  private javax.swing.JTextField txtScore;
  private javax.swing.JTextField txtTern;
  // End of variables declaration//GEN-END:variables
}
