package Project.View;

import Project.Controller.StudentDAO;
import Project.Model.Student;
import java.awt.event.KeyEvent;
import java.text.DateFormat;
import java.text.SimpleDateFormat;
import java.util.List;
import javax.swing.JOptionPane;
import javax.swing.table.DefaultTableModel;
import java.util.ArrayList;
import javax.swing.UIManager;
import javax.swing.table.TableRowSorter;

public class FrmListStudent extends javax.swing.JFrame {

    /**
     * Creates new form frmDanhSachSinhVien
     */
    public FrmListStudent() {
        initComponents();
        setLocationRelativeTo(null);
        setResizable(false);
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
  // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
  private void initComponents() {

    buttonGroup1 = new javax.swing.ButtonGroup();
    jTabbedPane1 = new javax.swing.JTabbedPane();
    jPanel4 = new javax.swing.JPanel();
    jPanel6 = new javax.swing.JPanel();
    jLabel3 = new javax.swing.JLabel();
    jLabel2 = new javax.swing.JLabel();
    txtTenSV = new javax.swing.JTextField();
    txtMaSV = new javax.swing.JTextField();
    btnTimKiem = new javax.swing.JButton();
    jPanel7 = new javax.swing.JPanel();
    jScrollPane2 = new javax.swing.JScrollPane();
    tbDSSV = new javax.swing.JTable();
    btnThemMoi = new javax.swing.JButton();
    btnSua = new javax.swing.JButton();
    btnXoa = new javax.swing.JButton();
    btnDong = new javax.swing.JButton();

    setDefaultCloseOperation(javax.swing.WindowConstants.DISPOSE_ON_CLOSE);
    setResizable(false);
    addWindowListener(new java.awt.event.WindowAdapter() {
      public void windowOpened(java.awt.event.WindowEvent evt) {
        formWindowOpened(evt);
      }
    });

    jTabbedPane1.setMinimumSize(new java.awt.Dimension(500, 500));
    jTabbedPane1.setPreferredSize(new java.awt.Dimension(1000, 1000));

    jPanel4.setPreferredSize(new java.awt.Dimension(766, 500));
    jPanel4.addMouseListener(new java.awt.event.MouseAdapter() {
      public void mouseClicked(java.awt.event.MouseEvent evt) {
        jPanel4MouseClicked(evt);
      }
    });

    jPanel6.setBorder(javax.swing.BorderFactory.createTitledBorder("Search"));

    jLabel3.setFont(new java.awt.Font("Arial", 1, 13)); // NOI18N
    jLabel3.setForeground(new java.awt.Color(255, 0, 0));
    jLabel3.setHorizontalAlignment(javax.swing.SwingConstants.CENTER);
    jLabel3.setText("ID Student:");
    jLabel3.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);

    jLabel2.setFont(new java.awt.Font("Arial", 1, 13)); // NOI18N
    jLabel2.setForeground(new java.awt.Color(255, 0, 0));
    jLabel2.setText("Name Student:");

    txtTenSV.addKeyListener(new java.awt.event.KeyAdapter() {
      public void keyReleased(java.awt.event.KeyEvent evt) {
        txtTenSVKeyReleased(evt);
      }
    });

    txtMaSV.addKeyListener(new java.awt.event.KeyAdapter() {
      public void keyReleased(java.awt.event.KeyEvent evt) {
        txtMaSVKeyReleased(evt);
      }
    });

    btnTimKiem.setIcon(new javax.swing.ImageIcon(getClass().getResource("/Project/images/ZoomHS.png"))); // NOI18N
    btnTimKiem.setText("Search");
    btnTimKiem.addActionListener(new java.awt.event.ActionListener() {
      public void actionPerformed(java.awt.event.ActionEvent evt) {
        btnTimKiemActionPerformed(evt);
      }
    });

    javax.swing.GroupLayout jPanel6Layout = new javax.swing.GroupLayout(jPanel6);
    jPanel6.setLayout(jPanel6Layout);
    jPanel6Layout.setHorizontalGroup(
      jPanel6Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
      .addGroup(jPanel6Layout.createSequentialGroup()
        .addContainerGap()
        .addComponent(jLabel3)
        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
        .addComponent(txtMaSV, javax.swing.GroupLayout.PREFERRED_SIZE, 183, javax.swing.GroupLayout.PREFERRED_SIZE)
        .addGap(18, 18, 18)
        .addComponent(jLabel2)
        .addGap(18, 18, 18)
        .addComponent(txtTenSV, javax.swing.GroupLayout.PREFERRED_SIZE, 205, javax.swing.GroupLayout.PREFERRED_SIZE)
        .addGap(36, 36, 36)
        .addComponent(btnTimKiem)
        .addContainerGap(79, Short.MAX_VALUE))
    );
    jPanel6Layout.setVerticalGroup(
      jPanel6Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
      .addGroup(jPanel6Layout.createSequentialGroup()
        .addGroup(jPanel6Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
          .addComponent(jLabel3)
          .addComponent(jLabel2)
          .addComponent(txtTenSV, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
          .addComponent(txtMaSV, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
          .addComponent(btnTimKiem))
        .addGap(0, 7, Short.MAX_VALUE))
    );

    jPanel6Layout.linkSize(javax.swing.SwingConstants.VERTICAL, new java.awt.Component[] {jLabel2, jLabel3});

    jPanel7.setBorder(javax.swing.BorderFactory.createTitledBorder("List"));

    tbDSSV.setModel(new javax.swing.table.DefaultTableModel(
      new Object [][] {
        {null, null, null, null, null, null, null, null},
        {null, null, null, null, null, null, null, null},
        {null, null, null, null, null, null, null, null},
        {null, null, null, null, null, null, null, null}
      },
      new String [] {
        "ID Student", "Name", "Sex", "Birthday", "Mobile", "Adress", "Email", "Counselor"
      }
    ));
    tbDSSV.setToolTipText("");
    tbDSSV.setMaximumSize(new java.awt.Dimension(2147483647, 2147483647));
    jScrollPane2.setViewportView(tbDSSV);
    if (tbDSSV.getColumnModel().getColumnCount() > 0) {
      tbDSSV.getColumnModel().getColumn(0).setPreferredWidth(5);
    }

    javax.swing.GroupLayout jPanel7Layout = new javax.swing.GroupLayout(jPanel7);
    jPanel7.setLayout(jPanel7Layout);
    jPanel7Layout.setHorizontalGroup(
      jPanel7Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
      .addComponent(jScrollPane2, javax.swing.GroupLayout.DEFAULT_SIZE, 802, Short.MAX_VALUE)
    );
    jPanel7Layout.setVerticalGroup(
      jPanel7Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
      .addGroup(jPanel7Layout.createSequentialGroup()
        .addContainerGap()
        .addComponent(jScrollPane2, javax.swing.GroupLayout.DEFAULT_SIZE, 333, Short.MAX_VALUE))
    );

    btnThemMoi.setIcon(new javax.swing.ImageIcon(getClass().getResource("/Project/images/add-icon.png"))); // NOI18N
    btnThemMoi.setText("Add");
    btnThemMoi.addActionListener(new java.awt.event.ActionListener() {
      public void actionPerformed(java.awt.event.ActionEvent evt) {
        btnThemMoiActionPerformed(evt);
      }
    });

    btnSua.setIcon(new javax.swing.ImageIcon(getClass().getResource("/Project/images/book_edit.png"))); // NOI18N
    btnSua.setText("Edit");
    btnSua.addActionListener(new java.awt.event.ActionListener() {
      public void actionPerformed(java.awt.event.ActionEvent evt) {
        btnSuaActionPerformed(evt);
      }
    });

    btnXoa.setIcon(new javax.swing.ImageIcon(getClass().getResource("/Project/images/delete.png"))); // NOI18N
    btnXoa.setText("Delete");
    btnXoa.addActionListener(new java.awt.event.ActionListener() {
      public void actionPerformed(java.awt.event.ActionEvent evt) {
        btnXoaActionPerformed(evt);
      }
    });

    btnDong.setIcon(new javax.swing.ImageIcon(getClass().getResource("/Project/images/cancel.gif"))); // NOI18N
    btnDong.setText("Cancel");
    btnDong.addActionListener(new java.awt.event.ActionListener() {
      public void actionPerformed(java.awt.event.ActionEvent evt) {
        btnDongActionPerformed(evt);
      }
    });

    javax.swing.GroupLayout jPanel4Layout = new javax.swing.GroupLayout(jPanel4);
    jPanel4.setLayout(jPanel4Layout);
    jPanel4Layout.setHorizontalGroup(
      jPanel4Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
      .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, jPanel4Layout.createSequentialGroup()
        .addGroup(jPanel4Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
          .addGroup(jPanel4Layout.createSequentialGroup()
            .addContainerGap()
            .addComponent(jPanel6, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
          .addGroup(jPanel4Layout.createSequentialGroup()
            .addGap(21, 470, Short.MAX_VALUE)
            .addComponent(btnThemMoi)
            .addGap(18, 18, 18)
            .addComponent(btnSua)
            .addGap(18, 18, 18)
            .addComponent(btnXoa)
            .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
            .addComponent(btnDong)))
        .addContainerGap())
      .addGroup(jPanel4Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
        .addGroup(jPanel4Layout.createSequentialGroup()
          .addContainerGap()
          .addComponent(jPanel7, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
          .addContainerGap()))
    );
    jPanel4Layout.setVerticalGroup(
      jPanel4Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
      .addGroup(jPanel4Layout.createSequentialGroup()
        .addContainerGap()
        .addComponent(jPanel6, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, 370, Short.MAX_VALUE)
        .addGroup(jPanel4Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
          .addComponent(btnThemMoi)
          .addComponent(btnSua)
          .addComponent(btnXoa)
          .addComponent(btnDong))
        .addContainerGap())
      .addGroup(jPanel4Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
        .addGroup(jPanel4Layout.createSequentialGroup()
          .addGap(70, 70, 70)
          .addComponent(jPanel7, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
          .addContainerGap(35, Short.MAX_VALUE)))
    );

    jTabbedPane1.addTab("Manage Student", jPanel4);

    javax.swing.GroupLayout layout = new javax.swing.GroupLayout(getContentPane());
    getContentPane().setLayout(layout);
    layout.setHorizontalGroup(
      layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
      .addComponent(jTabbedPane1, javax.swing.GroupLayout.DEFAULT_SIZE, 839, Short.MAX_VALUE)
    );
    layout.setVerticalGroup(
      layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
      .addComponent(jTabbedPane1, javax.swing.GroupLayout.DEFAULT_SIZE, 500, Short.MAX_VALUE)
    );

    pack();
  }// </editor-fold>//GEN-END:initComponents

    private void formWindowOpened(java.awt.event.WindowEvent evt) {//GEN-FIRST:event_formWindowOpened
        this.setTitle("Manage Student");
        hienThiDanhSachSV();

    }//GEN-LAST:event_formWindowOpened

  private void btnDongActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnDongActionPerformed
      this.dispose();
  }//GEN-LAST:event_btnDongActionPerformed

  private void btnXoaActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnXoaActionPerformed
      int select = tbDSSV.getSelectedRow();
      if (select == -1) {
          JOptionPane.showMessageDialog(this,
                  "Please choose student");
          return;
      }
      StudentDAO svd = new StudentDAO();
      String maSV = (String) tbDSSV.getValueAt(select, 0);
      if (JOptionPane.showConfirmDialog(this, "Bạn muốn xóa", "Bạn chắc chắn "
              + "muốn xóa", JOptionPane.YES_NO_OPTION) == JOptionPane.YES_OPTION) {
          boolean kq = svd.delete(maSV);
          if (kq) {
              JOptionPane.showMessageDialog(rootPane, "Sucess");
              hienThiDanhSachSV();
          }
      }
  }//GEN-LAST:event_btnXoaActionPerformed

  private void btnSuaActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnSuaActionPerformed
      int select = tbDSSV.getSelectedRow();
      if (select == -1) {
          JOptionPane.showMessageDialog(this,
                  "Please choose student");
          return;
      }
      String maSV = (String) tbDSSV.getValueAt(select, 0);
      String cbo = (String) tbDSSV.getValueAt(select, 7);
      FrmUpdateStudent frm = new FrmUpdateStudent();
      frm.setMaSV(maSV);
      frm.setCboMa(cbo);
      frm.setVisible(true);
  }//GEN-LAST:event_btnSuaActionPerformed

  private void btnThemMoiActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnThemMoiActionPerformed
      FrmUpdateStudent frm = new FrmUpdateStudent();
      frm.setVisible(true);
  }//GEN-LAST:event_btnThemMoiActionPerformed

  private void jPanel4MouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_jPanel4MouseClicked
      hienThiDanhSachSV();
  }//GEN-LAST:event_jPanel4MouseClicked

  private void btnTimKiemActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnTimKiemActionPerformed
      search();
  }//GEN-LAST:event_btnTimKiemActionPerformed

  private void txtMaSVKeyReleased(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_txtMaSVKeyReleased
      if (evt.getKeyCode() == KeyEvent.VK_ENTER) {
          txtTenSV.requestFocus();
      }
  }//GEN-LAST:event_txtMaSVKeyReleased

  private void txtTenSVKeyReleased(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_txtTenSVKeyReleased

      search();
  }//GEN-LAST:event_txtTenSVKeyReleased

    private void search() {
        String tenSV = txtTenSV.getText();
        String maSV = txtMaSV.getText();
        List<Student> lst = new ArrayList<>();
        if (tenSV != null && (maSV.isEmpty() || maSV == null)) {
            lst = StudentDAO.getInstance().find("", tenSV);
        } else if (maSV != null && (tenSV.isEmpty() || tenSV == null)) {
            lst = StudentDAO.getInstance().find(maSV, "");
        } else {
            lst = StudentDAO.getInstance().find(maSV, tenSV);
        }
        hienThiDanhSachSV(lst);
    }

    public void hienThiDanhSachSV() {
        hienThiDanhSachSV(StudentDAO.getInstance().getAll());
    }

    public void hienThiDanhSachSV(List<Student> lstSinhVien) {
        String colTieuDe[] = new String[]{"ID", "Name", "Sex",
            "Birthday", "Adress", "Mobie", "Email", "Class", "Counselor"};
        DefaultTableModel model = new DefaultTableModel(colTieuDe, 0);
        Object objSinhVien[];
        DateFormat df = new SimpleDateFormat("dd/MM/yyyy");
        for (Student sv : lstSinhVien) {
            objSinhVien = new Object[colTieuDe.length];
            objSinhVien[0] = sv.getIdStudent();
            objSinhVien[1] = sv.getName();
            if (sv.getSex() == 1) {
                objSinhVien[2] = "Male";
            } else {
                objSinhVien[2] = "Female";
            }
            if (sv.getBirthday() != null) {
                objSinhVien[3] = df.format(sv.getBirthday());
            }
            objSinhVien[4] = sv.getAdress();
            objSinhVien[5] = sv.getMobile();
            objSinhVien[6] = sv.getEmail();
            objSinhVien[7] = sv.getCs().getName();
            objSinhVien[8] = sv.getLt().getName();
            model.addRow(objSinhVien);
        }
        tbDSSV.setModel(model);
        TableRowSorter tbs = new TableRowSorter(model);
        tbDSSV.setRowSorter(tbs);
    }

    public static void main(String args[]) {
        /* Set the Nimbus look and feel */
        //<editor-fold defaultstate="collapsed" desc=" Look and feel setting code (optional) ">
        /* If Nimbus (introduced in Java SE 6) is not available, stay with the default look and feel.
         * For details see http://download.oracle.com/javase/tutorial/uiswing/lookandfeel/plaf.html 
         */
        try {
            for (javax.swing.UIManager.LookAndFeelInfo info : javax.swing.UIManager.getInstalledLookAndFeels()) {
                if ("Nimbus".equals(info.getName())) {
                    javax.swing.UIManager.setLookAndFeel(info.getClassName());
                    break;
                }
            }
        } catch (ClassNotFoundException ex) {
            java.util.logging.Logger.getLogger(FrmListStudent.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (InstantiationException ex) {
            java.util.logging.Logger.getLogger(FrmListStudent.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (IllegalAccessException ex) {
            java.util.logging.Logger.getLogger(FrmListStudent.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (javax.swing.UnsupportedLookAndFeelException ex) {
            java.util.logging.Logger.getLogger(FrmListStudent.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        }
        //</editor-fold>
        //</editor-fold>
        //</editor-fold>
        //</editor-fold>
        //</editor-fold>
        //</editor-fold>
        //</editor-fold>
        //</editor-fold>

        /* Create and display the form */
        java.awt.EventQueue.invokeLater(new Runnable() {
            public void run() {
                try {
                    UIManager.setLookAndFeel(UIManager.getSystemLookAndFeelClassName());
                } catch (Exception e) {
                }
                new FrmListStudent().setVisible(true);
            }
        });
    }

  // Variables declaration - do not modify//GEN-BEGIN:variables
  private javax.swing.JButton btnDong;
  private javax.swing.JButton btnSua;
  private javax.swing.JButton btnThemMoi;
  private javax.swing.JButton btnTimKiem;
  private javax.swing.JButton btnXoa;
  private javax.swing.ButtonGroup buttonGroup1;
  private javax.swing.JLabel jLabel2;
  private javax.swing.JLabel jLabel3;
  private javax.swing.JPanel jPanel4;
  private javax.swing.JPanel jPanel6;
  private javax.swing.JPanel jPanel7;
  private javax.swing.JScrollPane jScrollPane2;
  private javax.swing.JTabbedPane jTabbedPane1;
  private javax.swing.JTable tbDSSV;
  private javax.swing.JTextField txtMaSV;
  private javax.swing.JTextField txtTenSV;
  // End of variables declaration//GEN-END:variables
}
